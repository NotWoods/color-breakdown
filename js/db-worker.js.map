{"version":3,"file":"db-worker.js","sources":["../../node_modules/idb/build/esm/chunk.js","../../node_modules/idb/build/esm/index.js","../../src/db-worker/process-entry.ts","../../src/db-worker/examples.ts","../../src/db-worker/db.ts","../../src/revoke-object-url.ts","../../src/db-worker/handle-message.ts","../../src/db-worker/index.ts"],"sourcesContent":["const instanceOfAny = (object, constructors) => constructors.some(c => object instanceof c);\n\nlet idbProxyableTypes;\r\nlet cursorAdvanceMethods;\r\n// This is a function to prevent it throwing up in node environments.\r\nfunction getIdbProxyableTypes() {\r\n    return (idbProxyableTypes ||\r\n        (idbProxyableTypes = [\r\n            IDBDatabase,\r\n            IDBObjectStore,\r\n            IDBIndex,\r\n            IDBCursor,\r\n            IDBTransaction,\r\n        ]));\r\n}\r\n// This is a function to prevent it throwing up in node environments.\r\nfunction getCursorAdvanceMethods() {\r\n    return (cursorAdvanceMethods ||\r\n        (cursorAdvanceMethods = [\r\n            IDBCursor.prototype.advance,\r\n            IDBCursor.prototype.continue,\r\n            IDBCursor.prototype.continuePrimaryKey,\r\n        ]));\r\n}\r\nconst cursorRequestMap = new WeakMap();\r\nconst transactionDoneMap = new WeakMap();\r\nconst transactionStoreNamesMap = new WeakMap();\r\nconst transformCache = new WeakMap();\r\nconst reverseTransformCache = new WeakMap();\r\nfunction promisifyRequest(request) {\r\n    const promise = new Promise((resolve, reject) => {\r\n        const unlisten = () => {\r\n            request.removeEventListener('success', success);\r\n            request.removeEventListener('error', error);\r\n        };\r\n        const success = () => {\r\n            resolve(wrap(request.result));\r\n            unlisten();\r\n        };\r\n        const error = () => {\r\n            reject(request.error);\r\n            unlisten();\r\n        };\r\n        request.addEventListener('success', success);\r\n        request.addEventListener('error', error);\r\n    });\r\n    promise\r\n        .then(value => {\r\n        // Since cursoring reuses the IDBRequest (*sigh*), we cache it for later retrieval\r\n        // (see wrapFunction).\r\n        if (value instanceof IDBCursor) {\r\n            cursorRequestMap.set(value, request);\r\n        }\r\n        // Catching to avoid \"Uncaught Promise exceptions\"\r\n    })\r\n        .catch(() => { });\r\n    // This mapping exists in reverseTransformCache but doesn't doesn't exist in transformCache. This\r\n    // is because we create many promises from a single IDBRequest.\r\n    reverseTransformCache.set(promise, request);\r\n    return promise;\r\n}\r\nfunction cacheDonePromiseForTransaction(tx) {\r\n    // Early bail if we've already created a done promise for this transaction.\r\n    if (transactionDoneMap.has(tx))\r\n        return;\r\n    const done = new Promise((resolve, reject) => {\r\n        const unlisten = () => {\r\n            tx.removeEventListener('complete', complete);\r\n            tx.removeEventListener('error', error);\r\n            tx.removeEventListener('abort', error);\r\n        };\r\n        const complete = () => {\r\n            resolve();\r\n            unlisten();\r\n        };\r\n        const error = () => {\r\n            reject(tx.error);\r\n            unlisten();\r\n        };\r\n        tx.addEventListener('complete', complete);\r\n        tx.addEventListener('error', error);\r\n        tx.addEventListener('abort', error);\r\n    });\r\n    // Cache it for later retrieval.\r\n    transactionDoneMap.set(tx, done);\r\n}\r\nlet idbProxyTraps = {\r\n    get(target, prop, receiver) {\r\n        if (target instanceof IDBTransaction) {\r\n            // Special handling for transaction.done.\r\n            if (prop === 'done')\r\n                return transactionDoneMap.get(target);\r\n            // Polyfill for objectStoreNames because of Edge.\r\n            if (prop === 'objectStoreNames') {\r\n                return target.objectStoreNames || transactionStoreNamesMap.get(target);\r\n            }\r\n            // Make tx.store return the only store in the transaction, or undefined if there are many.\r\n            if (prop === 'store') {\r\n                return receiver.objectStoreNames[1]\r\n                    ? undefined\r\n                    : receiver.objectStore(receiver.objectStoreNames[0]);\r\n            }\r\n        }\r\n        // Else transform whatever we get back.\r\n        return wrap(target[prop]);\r\n    },\r\n    has(target, prop) {\r\n        if (target instanceof IDBTransaction &&\r\n            (prop === 'done' || prop === 'store')) {\r\n            return true;\r\n        }\r\n        return prop in target;\r\n    },\r\n};\r\nfunction addTraps(callback) {\r\n    idbProxyTraps = callback(idbProxyTraps);\r\n}\r\nfunction wrapFunction(func) {\r\n    // Due to expected object equality (which is enforced by the caching in `wrap`), we\r\n    // only create one new func per func.\r\n    // Edge doesn't support objectStoreNames (booo), so we polyfill it here.\r\n    if (func === IDBDatabase.prototype.transaction &&\r\n        !('objectStoreNames' in IDBTransaction.prototype)) {\r\n        return function (storeNames, ...args) {\r\n            const tx = func.call(unwrap(this), storeNames, ...args);\r\n            transactionStoreNamesMap.set(tx, storeNames.sort ? storeNames.sort() : [storeNames]);\r\n            return wrap(tx);\r\n        };\r\n    }\r\n    // Cursor methods are special, as the behaviour is a little more different to standard IDB. In\r\n    // IDB, you advance the cursor and wait for a new 'success' on the IDBRequest that gave you the\r\n    // cursor. It's kinda like a promise that can resolve with many values. That doesn't make sense\r\n    // with real promises, so each advance methods returns a new promise for the cursor object, or\r\n    // undefined if the end of the cursor has been reached.\r\n    if (getCursorAdvanceMethods().includes(func)) {\r\n        return function (...args) {\r\n            // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\r\n            // the original object.\r\n            func.apply(unwrap(this), args);\r\n            return wrap(cursorRequestMap.get(this));\r\n        };\r\n    }\r\n    return function (...args) {\r\n        // Calling the original function with the proxy as 'this' causes ILLEGAL INVOCATION, so we use\r\n        // the original object.\r\n        return wrap(func.apply(unwrap(this), args));\r\n    };\r\n}\r\nfunction transformCachableValue(value) {\r\n    if (typeof value === 'function')\r\n        return wrapFunction(value);\r\n    // This doesn't return, it just creates a 'done' promise for the transaction,\r\n    // which is later returned for transaction.done (see idbObjectHandler).\r\n    if (value instanceof IDBTransaction)\r\n        cacheDonePromiseForTransaction(value);\r\n    if (instanceOfAny(value, getIdbProxyableTypes()))\r\n        return new Proxy(value, idbProxyTraps);\r\n    // Return the same value back if we're not going to transform it.\r\n    return value;\r\n}\r\nfunction wrap(value) {\r\n    // We sometimes generate multiple promises from a single IDBRequest (eg when cursoring), because\r\n    // IDB is weird and a single IDBRequest can yield many responses, so these can't be cached.\r\n    if (value instanceof IDBRequest)\r\n        return promisifyRequest(value);\r\n    // If we've already transformed this value before, reuse the transformed value.\r\n    // This is faster, but it also provides object equality.\r\n    if (transformCache.has(value))\r\n        return transformCache.get(value);\r\n    const newValue = transformCachableValue(value);\r\n    // Not all types are transformed.\r\n    // These may be primitive types, so they can't be WeakMap keys.\r\n    if (newValue !== value) {\r\n        transformCache.set(value, newValue);\r\n        reverseTransformCache.set(newValue, value);\r\n    }\r\n    return newValue;\r\n}\r\nconst unwrap = (value) => reverseTransformCache.get(value);\n\nexport { wrap as a, addTraps as b, instanceOfAny as c, reverseTransformCache as d, unwrap as e };\n","import { a as wrap, b as addTraps } from './chunk.js';\nexport { e as unwrap, a as wrap } from './chunk.js';\n\n/**\r\n * Open a database.\r\n *\r\n * @param name Name of the database.\r\n * @param version Schema version.\r\n * @param callbacks Additional callbacks.\r\n */\r\nfunction openDB(name, version, { blocked, upgrade, blocking } = {}) {\r\n    const request = indexedDB.open(name, version);\r\n    const openPromise = wrap(request);\r\n    if (upgrade) {\r\n        request.addEventListener('upgradeneeded', event => {\r\n            upgrade(wrap(request.result), event.oldVersion, event.newVersion, wrap(request.transaction));\r\n        });\r\n    }\r\n    if (blocked)\r\n        request.addEventListener('blocked', () => blocked());\r\n    if (blocking) {\r\n        openPromise.then(db => db.addEventListener('versionchange', blocking)).catch(() => { });\r\n    }\r\n    return openPromise;\r\n}\r\n/**\r\n * Delete a database.\r\n *\r\n * @param name Name of the database.\r\n */\r\nfunction deleteDB(name, { blocked } = {}) {\r\n    const request = indexedDB.deleteDatabase(name);\r\n    if (blocked)\r\n        request.addEventListener('blocked', () => blocked());\r\n    return wrap(request).then(() => undefined);\r\n}\n\nconst readMethods = ['get', 'getKey', 'getAll', 'getAllKeys', 'count'];\r\nconst writeMethods = ['put', 'add', 'delete', 'clear'];\r\nconst cachedMethods = new Map();\r\nfunction getMethod(target, prop) {\r\n    if (!(target instanceof IDBDatabase &&\r\n        !(prop in target) &&\r\n        typeof prop === 'string')) {\r\n        return;\r\n    }\r\n    if (cachedMethods.get(prop))\r\n        return cachedMethods.get(prop);\r\n    const targetFuncName = prop.replace(/FromIndex$/, '');\r\n    const useIndex = prop !== targetFuncName;\r\n    const isWrite = writeMethods.includes(targetFuncName);\r\n    if (\r\n    // Bail if the target doesn't exist on the target. Eg, getAll isn't in Edge.\r\n    !(targetFuncName in (useIndex ? IDBIndex : IDBObjectStore).prototype) ||\r\n        !(isWrite || readMethods.includes(targetFuncName))) {\r\n        return;\r\n    }\r\n    const method = async function (storeName, ...args) {\r\n        // isWrite ? 'readwrite' : undefined gzipps better, but fails in Edge :(\r\n        const tx = this.transaction(storeName, isWrite ? 'readwrite' : 'readonly');\r\n        let target = tx.store;\r\n        if (useIndex)\r\n            target = target.index(args.shift());\r\n        const returnVal = target[targetFuncName](...args);\r\n        if (isWrite)\r\n            await tx.done;\r\n        return returnVal;\r\n    };\r\n    cachedMethods.set(prop, method);\r\n    return method;\r\n}\r\naddTraps(oldTraps => ({\r\n    get: (target, prop, receiver) => getMethod(target, prop) || oldTraps.get(target, prop, receiver),\r\n    has: (target, prop) => !!getMethod(target, prop) || oldTraps.has(target, prop),\r\n}));\n\nexport { openDB, deleteDB };\n",null,null,null,null,null,null],"names":["idbProxyableTypes","cursorAdvanceMethods","cursorRequestMap","WeakMap","transactionDoneMap","transactionStoreNamesMap","transformCache","reverseTransformCache","idbProxyTraps","[object Object]","target","prop","receiver","IDBTransaction","get","objectStoreNames","undefined","objectStore","wrap","has","wrapFunction","func","IDBDatabase","prototype","transaction","IDBCursor","advance","continue","continuePrimaryKey","includes","args","apply","unwrap","this","storeNames","tx","call","set","sort","transformCachableValue","value","done","Promise","resolve","reject","unlisten","removeEventListener","complete","error","addEventListener","cacheDonePromiseForTransaction","object","IDBObjectStore","IDBIndex","some","c","Proxy","IDBRequest","request","promise","success","result","then","catch","promisifyRequest","newValue","readMethods","writeMethods","cachedMethods","Map","getMethod","targetFuncName","replace","useIndex","isWrite","method","async","storeName","store","index","shift","returnVal","processEntry","entry","timestamp","id","imgBlob","dataUri","header","data","split","mimeType","byteString","atob","buffer","ArrayBuffer","length","intBuffer","Uint8Array","i","charCodeAt","Blob","type","dataUriToBlob","imgSrc","URL","createObjectURL","colors","name","Date","toLocaleString","oldTraps","callback","white","black","EXAMPLES","vibrant","color","textColor","darkVibrant","lightVibrant","muted","darkMuted","lightMuted","dbPromise","version","blocked","upgrade","blocking","indexedDB","open","openPromise","event","oldVersion","newVersion","db","openDB","createObjectStore","keyPath","saveItemsToDB","items","entries","all","map","item","blob","fetch","r","reader","FileReader","onload","onerror","readAsDataURL","blobToDataUri","url","protocol","revokeObjectURL","forEach","put","handleMessage","action","postMessage","console","log","payload","firstLoad","exampleCb","historyCb","openCursor","cursor","hidden","key","loadHistoryFromDB","Number","isNaN","info","loadItemFromDB","delete","deleteItemFromDB","current","otherEntry","historyItems","getAll","exampleEntries","hiddenExamples","Set","filter","Array","from","values","find","example","openFirstItem","err","String","self","evt"],"mappings":"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"}